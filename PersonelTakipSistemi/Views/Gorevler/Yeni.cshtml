@model PersonelTakipSistemi.Models.Gorev
@{
    ViewData["Title"] = Model?.GorevId > 0 ? "Görevi Düzenle" : "Yeni Görev Ekle";
    Layout = "~/Views/Shared/_Layout.cshtml";
    
    // Check if Edit Mode
    bool isEdit = Model?.GorevId > 0;
}

<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">@ViewData["Title"]</h5>
                @if(isEdit) {
                    <span class="badge bg-label-warning">Düzenleme Modu #@Model?.GorevId</span>
                }
            </div>
            <div class="card-body">
                @if (!ViewData.ModelState.IsValid)
                {
                    <div class="alert alert-danger">
                        <ul class="mb-0 ps-3">
                            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                            {
                                <li>@error.ErrorMessage</li>
                            }
                        </ul>
                    </div>
                }

                <form asp-action="@(isEdit ? "Duzenle" : "Yeni")" method="post">
                    @if(isEdit) { <input type="hidden" asp-for="GorevId" /> }
                    
                    <div class="row g-3">
                        <!-- Görev Adı -->
                        <div class="col-12">
                            <label asp-for="Ad" class="form-label">Görev Adı *</label>
                            <input asp-for="Ad" class="form-control" placeholder="Örn: 9. Sınıf Matematik Dizgisi" />
                            <span asp-validation-for="Ad" class="text-danger"></span>
                        </div>

                        <!-- Açıklama -->
                        <div class="col-12">
                            <label asp-for="Aciklama" class="form-label">Görev Tanımı/Açıklama</label>
                            <textarea asp-for="Aciklama" class="form-control" rows="3" placeholder="Görev detayları..."></textarea>
                            <span asp-validation-for="Aciklama" class="text-danger"></span>
                        </div>

                        <!-- Kategori -->
                        <div class="col-md-6">
                            <label asp-for="KategoriId" class="form-label">Görev Kategorisi *</label>
                            <select asp-for="KategoriId" class="form-select" asp-items="ViewBag.Kategoriler">
                                <option value="">Seçiniz...</option>
                            </select>
                            <span asp-validation-for="KategoriId" class="text-danger"></span>
                        </div>

                         <!-- Durum -->
                        @if(!isEdit) {
                            <div class="col-md-6">
                                <label asp-for="GorevDurumId" class="form-label">Durum</label>
                                <select asp-for="GorevDurumId" class="form-select" asp-items="ViewBag.GorevDurumlari">
                                </select>
                                <span asp-validation-for="GorevDurumId" class="text-danger"></span>
                            </div>
                        } else {
                            <input type="hidden" asp-for="GorevDurumId" />
                        }



                         <!-- Tarihler -->
                        <div class="col-md-6">
                            <label asp-for="BaslangicTarihi" class="form-label">Başlangıç Tarihi *</label>
                            <input asp-for="BaslangicTarihi" type="date" class="form-control" value="@(Model?.BaslangicTarihi.ToString("yyyy-MM-dd") ?? DateTime.Now.ToString("yyyy-MM-dd"))" />
                            <span asp-validation-for="BaslangicTarihi" class="text-danger"></span>
                        </div>

                        <div class="col-md-6">
                            <label asp-for="BitisTarihi" class="form-label">Bitiş Tarihi</label>
                            <input asp-for="BitisTarihi" type="date" class="form-control" />
                            <span asp-validation-for="BitisTarihi" class="text-danger"></span>
                        </div>

                         <!-- Aktiflik -->
                        <div class="col-12">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" asp-for="IsActive" />
                                <label class="form-check-label" asp-for="IsActive">Kayıt Aktif mi?</label>
                            </div>
                        </div>

                        <div class="col-12 mt-4">
                            <button type="submit" class="btn btn-primary me-2">
                                <i class='bx bx-save'></i> Kaydet
                            </button>
                            <a asp-action="Liste" class="btn btn-outline-secondary">
                                <i class='bx bx-arrow-back'></i> İptal
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

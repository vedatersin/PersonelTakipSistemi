@{
    ViewData["Title"] = "Personel Yetkilendir";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="~/css/personel-yetkilendir.css" />
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
<style>
    /* Select2 overrides for custom filter bar */
    .select2-container .select2-selection--single {
        height: 42px;
        line-height: 42px;
        border: 1px solid #d9dee3;
    }
    .select2-container--bootstrap-5 .select2-selection--single .select2-selection__rendered {
        line-height: 40px;
    }
</style>

<div class="container-xxl flex-grow-1 container-p-y">
    <div class="row">
        <div class="col-12 mb-3">
            <h4 class="fw-bold py-3 mb-1"><span class="text-muted fw-light">Personel /</span> Yetkilendir</h4>
            <p class="text-muted">Personelleri yetkilendirmek ve atamalarını düzenlemek için arama yapabilir ve hızlı düzenleme yapabilirsiniz.</p>
        </div>
    </div>

    <!-- Filter Bar -->
    <div class="filter-bar">
        <input type="text" id="searchFilter" class="filter-input" placeholder="Ad Soyad Ara..." style="flex: 2;">
        
        <select id="teskilatFilter" class="filter-input">
            <option value="">Teşkilat: Tümü</option>
            <option value="Merkez">Merkez</option>
            <option value="Taşra">Taşra</option>
        </select>

        <select id="sistemRolFilter" class="filter-input">
            <option value="">Sistem Rolü: Tümü</option>
            <option value="Admin">Admin</option>
            <option value="Kullanıcı">Kullanıcı</option>
        </select>

        <select id="kurumsalRolFilter" class="filter-input">
            <option value="">Kurumsal Rol: Tümü</option>
            <option value="İl Koordinatörü">İl Koordinatörü</option>
            <option value="Merkez Birim Koordinatörlüğü">Merkez Birim Koordinatörlüğü</option>
            <option value="Komisyon Başkanı">Komisyon Başkanı</option>
            <option value="Personel">Personel</option>
        </select>

        <select id="komisyonFilter" class="filter-input">
            <option value="">Komisyon: Tümü</option>
            <option value="Türkçe Komisyonu">Türkçe Komisyonu</option>
            <option value="Matematik Komisyonu">Matematik Komisyonu</option>
            <option value="Fen Bilimleri Komisyonu">Fen Bilimleri Komisyonu</option>
        </select>

        <div style="flex: 1; text-align: right;">
            <button id="clearFiltersBtn" class="btn-filter-clear">Filtreleri Temizle</button>
        </div>
    </div>

    <!-- Main Content: Table + Drawer -->
    <div class="auth-page-container">
        
        <!-- Center Table Area -->
        <div class="auth-table-wrapper" id="authTableWrapper">
            <table class="auth-table">
                <thead>
                    <tr>
                        <th width="60">Foto</th>
                        <th>Ad Soyad</th>
                        <th>Teşkilat</th>
                        <th>Koordinatörlük</th>
                        <th>Komisyonlar</th>
                        <th>Sistem Rolü</th>
                        <th>Kurumsal Rol</th>
                    </tr>
                </thead>
                <tbody id="personelTableBody">
                    <!-- JS will populate rows here -->
                </tbody>
            </table>
        </div>

        <!-- Right Side Drawer -->
        <div class="auth-drawer-wrapper open" id="authDrawer">
            <div class="drawer-header">
                <div class="drawer-profile">
                    <img id="drawerAvatar" src="" class="auth-avatar" style="width: 48px; height: 48px; display: none;">
                    <div class="auth-avatar" id="drawerAvatarPlaceholder" style="width: 48px; height: 48px;"></div>
                    <div class="drawer-profile-info">
                        <h4 id="drawerName">Deniz Şimşek</h4>
                        <small id="drawerTeskilat">Merkez</small>
                    </div>
                </div>
                <button class="drawer-close-btn" id="drawerCloseBtn">&times;</button>
            </div>

            <div class="drawer-body">
                <div class="drawer-tabs">
                    <button class="drawer-tab-btn active" data-tab="kurumsal">Kurumsal Atamalar</button>
                    <button class="drawer-tab-btn" data-tab="sistemsel">Sistemsel Yetki</button>
                </div>

                <!-- Tab Kurumsal -->
                <div id="tabKurumsal" class="tab-content">
                    <div class="form-group">
                        <label class="form-label">Teşkilat</label>
                        <select id="drawerTeskilatSelect" class="form-control-custom" disabled>
                            <option value="Merkez">Merkez</option>
                            <option value="Taşra">Taşra</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Koordinatörlük</label>
                        <input type="text" id="drawerKoordinatorluk" class="form-control-custom" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Komisyonlar</label>
                        <select id="drawerKomisyonAdd" class="form-control-custom mb-1">
                            <option value="">+ Komisyon Ekle...</option>
                            <option value="Türkçe Komisyonu">Türkçe Komisyonu</option>
                            <option value="Matematik Komisyonu">Matematik Komisyonu</option>
                            <option value="Fen Bilimleri Komisyonu">Fen Bilimleri Komisyonu</option>
                        </select>
                        <div class="chip-list" id="drawerKomisyonChips">
                            <!-- Chips will go here -->
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Kurumsal Rol</label>
                        <select id="drawerKurumsalRol" class="form-control-custom">
                            <option value="Personel">Personel</option>
                            <option value="Komisyon Başkanı">Komisyon Başkanı</option>
                            <option value="İl Koordinatörü">İl Koordinatörü</option>
                            <option value="Merkez Birim Koordinatörlüğü">Merkez Birim Koordinatörlüğü</option>
                        </select>
                    </div>
                </div>

                <!-- Tab Sistemsel -->
                <div id="tabSistemsel" class="tab-content" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Sistem Rolü</label>
                        <select id="drawerSistemRol" class="form-control-custom">
                            <option value="Kullanıcı">Kullanıcı</option>
                            <option value="Admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Yetki Kapsamı</label>
                        <div class="radio-group">
                            <label class="radio-item">
                                <input type="radio" name="scope" value="Self" checked> Sadece Kendisi
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="scope" value="Komisyon"> Komisyonları
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="scope" value="Koordinatorluk"> Koordinatörlüğü
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="scope" value="All"> Tüm Sistem
                            </label>
                        </div>
                    </div>
                </div>

            </div>

            <div class="drawer-footer">
                <button type="button" class="btn btn-label-secondary" id="drawerCancelBtn">İptal</button>
                <button type="button" class="btn btn-primary" id="drawerSaveBtn">Kaydet</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            // Apply Select2 to filter dropdowns
            $('#teskilatFilter, #sistemRolFilter, #kurumsalRolFilter, #komisyonFilter').select2({
                theme: 'bootstrap-5',
                width: '100%', // Adjust as needed or use style
                minimumResultsForSearch: 10 // Only show search if many items
            });
            
            // Adjust width because they are flex items in CSS, might need wrapping div if pure select2
            // The original inputs were .filter-input with flex. Select2 replaces them.
            // We might need to target the container or ensure flex works on .select2-container
        });
    </script>
    <script src="~/js/personel-yetkilendir.js"></script>
}

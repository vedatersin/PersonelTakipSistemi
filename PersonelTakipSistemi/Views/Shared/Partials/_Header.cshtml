

<nav class="layout-navbar navbar navbar-expand-xl align-items-center bg-white ms-0 me-0 mt-5 rounded shadow" id="layout-navbar" style="min-height: 80px; padding-right: 2rem;">
  <div class="layout-menu-toggle navbar-nav align-items-xl-center me-4 me-xl-0 d-xl-none">
    <a class="nav-item nav-link px-0 me-xl-6" href="javascript:void(0)">
      <i class="icon-base bx bx-menu icon-md"></i>
    </a>
  </div>

  <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
    <ul class="navbar-nav flex-row align-items-center ms-auto">
      
      <!-- Notification Dropdown -->
      <li class="nav-item dropdown-notifications navbar-dropdown dropdown me-3 me-xl-1">
        <a class="nav-link dropdown-toggle hide-arrow position-relative" href="javascript:void(0);" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false" style="display: inline-block;">
          <i class="bx bx-bell" style="font-size: 2.25rem !important; color: #566a7f !important;"></i>
          <span id="notificationBadge" class="badge rounded-pill bg-danger" style="display:none; position: absolute; bottom: -1px; right: -1px; font-size: 0.75rem; padding: 0.3em 0.5em;"></span>
        </a>
        <ul class="dropdown-menu dropdown-menu-end py-0">
          <li class="dropdown-menu-header border-bottom">
            <div class="dropdown-header d-flex align-items-center py-3">
              <h5 class="text-body mb-0 me-auto">Bildirimler</h5>
              <a href="javascript:void(0)" class="dropdown-notifications-all text-body" data-bs-toggle="tooltip" data-bs-placement="top" title="Tümünü Okundu İşaretle" onclick="markAllRead()">
                <i class="bx bx-envelope-open fs-4"></i>
              </a>
            </div>
          </li>
          <li class="dropdown-notifications-list scrollable-container">
            <ul class="list-group list-group-flush" id="notificationList">
              <!-- Loaded via JS -->
            </ul>
          </li>
          <li class="dropdown-menu-footer border-top p-3">
            <a asp-controller="Bildirimler" asp-action="Index" class="btn btn-primary text-uppercase w-100">Tüm Bildirimleri Gör</a>
          </li>
        </ul>
      </li>

@using PersonelTakipSistemi.Data
@inject TegmPersonelTakipDbContext _context
      <!-- User -->
      @if (User.Identity!.IsAuthenticated)
      {
          var userIdClaim = User.FindFirst("PersonelId")?.Value;
          var photoUrl = "";
          var displayName = User.Identity.Name ?? "Kullanıcı";
          var role = "Personel";

          if(int.TryParse(userIdClaim, out int pid)) {
              var p = _context.Personeller.Find(pid);
              if(p != null) {
                 photoUrl = p.FotografYolu;
                 displayName = p.Ad + " " + p.Soyad; 
              }
          }

          // Initials Logic
          var initials = "";
          if(!string.IsNullOrEmpty(displayName)) {
              var parts = displayName.Split(' ', StringSplitOptions.RemoveEmptyEntries);
              if(parts.Length > 0) initials += parts[0][0];
              if(parts.Length > 1) initials += parts[parts.Length - 1][0];
          }
          initials = initials.ToUpper();

          <li class="nav-item navbar-dropdown dropdown-user dropdown">
            <a class="nav-link dropdown-toggle hide-arrow p-0 d-flex align-items-center" href="javascript:void(0);" data-bs-toggle="dropdown">
              <div class="avatar avatar-online" style="width: 50px; height: 50px;">
                @if(!string.IsNullOrEmpty(photoUrl)) {
                    <img src="@photoUrl" alt class="w-px-50 rounded-circle" style="object-fit: cover; width: 50px; height: 50px;" />
                } else {
                    <span class="avatar-initial rounded-circle bg-label-primary" style="width: 50px; height: 50px; font-size: 1.25rem;">@initials</span>
                }
              </div>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li>
                <a class="dropdown-item" href="#">
                  <div class="d-flex">
                    <div class="flex-shrink-0 me-3">
                      <div class="avatar avatar-online" style="width: 50px; height: 50px;">
                        @if(!string.IsNullOrEmpty(photoUrl)) {
                            <img src="@photoUrl" alt class="w-px-50 rounded-circle" style="object-fit: cover; width: 50px; height: 50px;" />
                        } else {
                             <span class="avatar-initial rounded-circle bg-label-primary" style="width: 50px; height: 50px; font-size: 1.25rem;">@initials</span>
                        }
                      </div>
                    </div>
                    <div class="flex-grow-1">
                      <h6 class="mb-0">@displayName</h6>
                      <small class="text-body-secondary">@role</small>
                    </div>
                  </div>
                </a>
              </li>
              <li>
                <div class="dropdown-divider my-1"></div>
              </li>
              <li>
                <a class="dropdown-item" asp-controller="Personel" asp-action="BenimDetay">
                  <i class="icon-base bx bx-user icon-md me-3"></i><span>Profil</span>
                </a>
              </li>
              <li>
                  <form asp-controller="Account" asp-action="Logout" method="post" id="logoutForm" class="d-inline">
                    <a class="dropdown-item" href="javascript:document.getElementById('logoutForm').submit();">
                      <i class="icon-base bx bx-power-off icon-md me-3"></i><span>Çıkış</span>
                    </a>
                  </form>
              </li>
            </ul>
          </li>
      }
      else
      {
           <li class="nav-item">
              <a class="nav-link" asp-controller="Account" asp-action="Login">Giriş Yap</a>
           </li>
      }
      <!--/ User -->
    </ul>
  </div>
</nav>

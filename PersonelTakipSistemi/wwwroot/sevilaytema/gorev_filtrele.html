<!doctype html>
<html
  lang="tr"
  class="layout-menu-fixed layout-compact"
  data-assets-path="../assets/"
  data-template="vertical-menu-template-free">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <title>Personel Takip Sistemi | Görev Filtrele</title>
    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/img/favicon/favicon.ico" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet" />

    <link rel="stylesheet" href="assets/vendor/fonts/iconify-icons.css" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="assets/vendor/css/core.css" />
    <link rel="stylesheet" href="assets/css/demo.css" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />

    <!-- Helpers -->
    <script src="assets/vendor/js/helpers.js"></script>
    <script src="assets/js/config.js"></script>

    <style>
      .filter-chip { display:inline-flex; align-items:center; gap:.5rem; }
      .filter-chip .btn-close { transform: scale(.85); }
      .table td, .table th { vertical-align: middle; }
      .w-220 { width: 220px; }
      .sticky-actions { position: sticky; bottom: 0; background: #fff; padding-top: .75rem; }
      .layout-dark .sticky-actions { background: transparent; }
    </style>
  </head>

  <body>
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">

        <!-- Menu -->
        <div data-include="partials/sidebar.html"></div>
        <!-- / Menu -->

        <div class="layout-page">

          <!-- Navbar -->
          <div data-include="partials/navbar.html"></div>
          <!-- / Navbar -->

          <div class="content-wrapper">
            <div class="container-fluid flex-grow-1 container-p-y">

              <!-- Başlık + Aksiyonlar -->
              <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-2">
                <div>
                  <h4 class="mb-1">Görev Filtrele</h4>
                  <div class="text-muted">Filtreleri seç, sonuçları listele ve çıktı al.</div>
                </div>

                <div class="d-flex gap-2">
                  <!-- Mobilde filtre -->
                  <button
                    type="button"
                    class="btn btn-outline-primary d-md-none"
                    data-bs-toggle="offcanvas"
                    data-bs-target="#offcanvasFilters"
                    aria-controls="offcanvasFilters">
                    <i class="bx bx-filter-alt me-1"></i> Filtreler
                  </button>

                  <button type="button" class="btn btn-outline-secondary" id="btnExport">
                    <i class="bx bx-download me-1"></i> Dışa Aktar
                  </button>
                  <button type="button" class="btn btn-primary" id="btnPrint">
                    <i class="bx bx-printer me-1"></i> Yazdır
                  </button>
                </div>
              </div>

              <div class="row g-4">
                <!-- SOL: Filtreler (Desktop) -->
                <div class="col-12 col-md-4 col-lg-3 d-none d-md-block">
                  <div class="card">
                    <h5 class="card-header d-flex align-items-center justify-content-between">
                      Filtreler
                      <span class="badge bg-label-primary" id="activeFilterCount">0</span>
                    </h5>

                    <div class="card-body">
                      <form id="filterForm" autocomplete="off">
                        <div class="mb-3">
                          <label class="form-label" for="q">Arama</label>
                          <input class="form-control" id="q" name="q" placeholder="Görev adı, açıklama, kişi..." />
                        </div>

                        <div class="mb-3">
                          <label class="form-label" for="kategori">Kategori</label>
                          <select class="form-select" id="kategori" name="kategori">
                            <option value="">Tümü</option>
                            <option>Ders Kitapları Kategorisi</option>
                            <option>Yardımcı Kaynaklar</option>
                            <option>Dijital İçerik</option>
                            <option>Programlar</option>
                          </select>
                        </div>

                        <div class="mb-3">
                          <label class="form-label" for="durum">Durum</label>
                          <select class="form-select" id="durum" name="durum">
                            <option value="">Tümü</option>
                            <option value="aktif">Aktif</option>
                            <option value="pasif">Pasif</option>
                            <option value="tamamlandi">Tamamlandı</option>
                            <option value="beklemede">Beklemede</option>
                          </select>
                        </div>

                                               <div class="row g-2 mb-3">
                          <div class="col-6">
                            <label class="form-label" for="tarihBas">Başlangıç</label>
                            <input type="date" class="form-control" id="tarihBas" name="tarihBas" />
                          </div>
                          <div class="col-6">
                            <label class="form-label" for="tarihBit">Bitiş</label>
                            <input type="date" class="form-control" id="tarihBit" name="tarihBit" />
                          </div>
                        </div>

                        <div class="mb-3">
                          <label class="form-label" for="birim">Birim</label>
                          <select class="form-select" id="birim" name="birim">
                            <option value="">Tümü</option>
                            <option>Koordinatörlük</option>
                            <option>Komisyon</option>
                          </select>
                        </div>

                        <div class="mb-3">
                          <label class="form-label" for="personel">Personel</label>
                          <select class="form-select" id="personel" name="personel">
                            <option value="">Tümü</option>
                            <option>Sevilay S.</option>
                            <option>Vedat K.</option>
                            <option>Örnek Personel</option>
                          </select>
                        </div>

                        <div class="form-check mb-3">
                          <input class="form-check-input" type="checkbox" id="sadeceAktif" name="sadeceAktif" />
                          <label class="form-check-label" for="sadeceAktif">Sadece aktif görevler</label>
                        </div>

                        <div class="sticky-actions d-flex gap-2">
                          <button type="button" class="btn btn-outline-secondary w-100" id="btnReset">
                            Temizle
                          </button>
                          <button type="submit" class="btn btn-primary w-100" id="btnApply">
                            Filtrele
                          </button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>

                <!-- SAĞ: Sonuçlar -->
                <div class="col-12 col-md-8 col-lg-9">
                  <div class="card">
                    <div class="card-header d-flex flex-wrap gap-2 justify-content-between align-items-center">
                      <div class="d-flex align-items-center gap-2">
                        <h5 class="mb-0">Sonuçlar</h5>
                        <span class="badge bg-label-success" id="resultCount">0</span>
                      </div>

                      <div class="d-flex gap-2">
                        <select class="form-select w-220" id="sortBy">
                          <option value="tarih_desc">Tarihe göre (Yeni)</option>
                          <option value="tarih_asc">Tarihe göre (Eski)</option>
                          <option value="oncelik_desc">Öncelik (Yüksek)</option>
                          <option value="oncelik_asc">Öncelik (Düşük)</option>
                        </select>

                        <select class="form-select w-220" id="pageSize">
                          <option value="10">10 / sayfa</option>
                          <option value="25" selected>25 / sayfa</option>
                          <option value="50">50 / sayfa</option>
                        </select>
                      </div>
                    </div>

                    <div class="card-body">
                      <!-- Aktif filtre çipleri -->
                      <div class="mb-3" id="activeChips"></div>

                      <div class="table-responsive">
                        <table class="table table-hover">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th>Görev</th>
                              <th>Kategori</th>
                              <th>Personel</th>
                              <th>Tarih</th>
                              <th>Durum</th>
                              <th class="text-end">İşlem</th>
                            </tr>
                          </thead>
                          <tbody id="taskTbody">
                            <!-- Örnek satırlar -->
                            <tr data-kategori="Dijital İçerik" data-personel="Sevilay S." data-durum="aktif">
                              <td>1</td>
                              <td>
                                <div class="fw-semibold">İçerik kontrol listesi</div>
                                <div class="text-muted small">Dijital içerik kalite kontrol</div>
                              </td>
                              <td><span class="badge bg-label-info">Dijital İçerik</span></td>
                              <td>Sevilay S.</td>
                              <td>2025-12-18</td>
                              <td><span class="badge bg-label-success">Aktif</span></td>
                              <td class="text-end">
                                  <a class="btn btn-sm btn-outline-primary" href="gorev_detay.html?id=1" role="button">Detay</a>

                                <button class="btn btn-sm btn-outline-secondary">Düzenle</button>
                              </td>
                            </tr>

                            <tr data-kategori="Programlar" data-personel="Vedat K." data-durum="beklemede">
                              <td>2</td>
                              <td>
                                <div class="fw-semibold">Program güncelleme</div>
                                <div class="text-muted small">Müfredat uyum kontrolü</div>
                              </td>
                              <td><span class="badge bg-label-warning">Programlar</span></td>
                              <td>Vedat K.</td>
                              <td>2025-12-10</td>
                              <td><span class="badge bg-label-warning">Beklemede</span></td>
                              <td class="text-end">
                                <button class="btn btn-sm btn-outline-primary">Detay</button>
                                <button class="btn btn-sm btn-outline-secondary">Düzenle</button>
                              </td>
                            </tr>

                            <tr data-kategori="Yardımcı Kaynaklar" data-personel="Örnek Personel" data-durum="tamamlandi">
                              <td>3</td>
                              <td>
                                <div class="fw-semibold">Kaynak değerlendirme</div>
                                <div class="text-muted small">Yardımcı kaynak uygunluk raporu</div>
                              </td>
                              <td><span class="badge bg-label-secondary">Yardımcı Kaynaklar</span></td>
                              <td>Örnek Personel</td>
                              <td>2025-11-30</td>
                              <td><span class="badge bg-label-primary">Tamamlandı</span></td>
                              <td class="text-end">
                                <button class="btn btn-sm btn-outline-primary">Detay</button>
                                <button class="btn btn-sm btn-outline-secondary">Düzenle</button>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>

                      <!-- Basit sayfalama görüntüsü -->
                      <div class="d-flex justify-content-between align-items-center mt-3">
                        <div class="text-muted small" id="pagingInfo">Gösterilen: -</div>
                        <nav aria-label="Sayfalama">
                          <ul class="pagination mb-0">
                            <li class="page-item disabled"><a class="page-link" href="#">Önceki</a></li>
                            <li class="page-item active"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">Sonraki</a></li>
                          </ul>
                        </nav>
                      </div>

                    </div>
                  </div>
                </div>
              </div>

              <!-- Mobil Offcanvas Filtre -->
              <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasFilters" aria-labelledby="offcanvasFiltersLabel">
                <div class="offcanvas-header">
                  <h5 class="offcanvas-title" id="offcanvasFiltersLabel">Filtreler</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Kapat"></button>
                </div>
                <div class="offcanvas-body">
                  <!-- Aynı formu mobilde de kullanmak için kopyaladık -->
                  <form id="filterFormMobile">
                    <div class="mb-3">
                      <label class="form-label" for="q_m">Arama</label>
                      <input class="form-control" id="q_m" name="q" placeholder="Görev adı, açıklama, kişi..." />
                    </div>

                    <div class="mb-3">
                      <label class="form-label" for="kategori_m">Kategori</label>
                      <select class="form-select" id="kategori_m" name="kategori">
                        <option value="">Tümü</option>
                        <option>Ders Kitapları Kategorisi</option>
                        <option>Yardımcı Kaynaklar</option>
                        <option>Dijital İçerik</option>
                        <option>Programlar</option>
                      </select>
                    </div>

                    <div class="mb-3">
                      <label class="form-label" for="durum_m">Durum</label>
                      <select class="form-select" id="durum_m" name="durum">
                        <option value="">Tümü</option>
                        <option value="aktif">Aktif</option>
                        <option value="pasif">Pasif</option>
                        <option value="tamamlandi">Tamamlandı</option>
                        <option value="beklemede">Beklemede</option>
                      </select>
                    </div>

                    <div class="row g-2 mb-3">
                      <div class="col-6">
                        <label class="form-label" for="tarihBas_m">Başlangıç</label>
                        <input type="date" class="form-control" id="tarihBas_m" name="tarihBas" />
                      </div>
                      <div class="col-6">
                        <label class="form-label" for="tarihBit_m">Bitiş</label>
                        <input type="date" class="form-control" id="tarihBit_m" name="tarihBit" />
                      </div>
                    </div>

                    <div class="form-check mb-3">
                      <input class="form-check-input" type="checkbox" id="sadeceAktif_m" name="sadeceAktif" />
                      <label class="form-check-label" for="sadeceAktif_m">Sadece aktif görevler</label>
                    </div>

                    <div class="d-flex gap-2">
                      <button type="button" class="btn btn-outline-secondary w-100" id="btnResetMobile">Temizle</button>
                      <button type="submit" class="btn btn-primary w-100">Filtrele</button>
                    </div>
                  </form>
                </div>
              </div>

            </div>

            <!-- Footer -->
            <div data-include="partials/footer.html"></div>
            <!-- / Footer -->

            <div class="content-backdrop fade"></div>
          </div>
        </div>
      </div>

      <div class="layout-overlay layout-menu-toggle"></div>
    </div>

    <!-- Core JS -->
    <script src="../assets/vendor/libs/jquery/jquery.js"></script>
    <script src="../assets/vendor/libs/popper/popper.js"></script>
    <script src="../assets/vendor/js/bootstrap.js"></script>
    <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="../assets/vendor/js/menu.js"></script>

    <!-- Main JS -->
    <script src="../assets/js/main.js"></script>

    <!-- Menüler eklendi -->
    <script src="assets/js/include.js"></script>

    <script>
      // Basit: formdan çip üret, tabloyu (örnek) filtrele, sayaçları güncelle
      function getFormData(formEl) {
        const fd = new FormData(formEl);
        const obj = {};
        for (const [k, v] of fd.entries()) obj[k] = v;
        obj.sadeceAktif = formEl.querySelector('[name="sadeceAktif"]')?.checked || false;
        return obj;
      }

      function setChips(filters) {
        const chips = [];
        if (filters.q) chips.push({ key: "q", label: `Arama: ${filters.q}` });
        if (filters.kategori) chips.push({ key: "kategori", label: `Kategori: ${filters.kategori}` });
        if (filters.durum) chips.push({ key: "durum", label: `Durum: ${filters.durum}` });
        if (filters.oncelik) chips.push({ key: "oncelik", label: `Öncelik: ${filters.oncelik}` });
        if (filters.personel) chips.push({ key: "personel", label: `Personel: ${filters.personel}` });
        if (filters.birim) chips.push({ key: "birim", label: `Birim: ${filters.birim}` });
        if (filters.tarihBas) chips.push({ key: "tarihBas", label: `Başlangıç: ${filters.tarihBas}` });
        if (filters.tarihBit) chips.push({ key: "tarihBit", label: `Bitiş: ${filters.tarihBit}` });
        if (filters.sadeceAktif) chips.push({ key: "sadeceAktif", label: "Sadece aktif" });

        const wrap = document.getElementById("activeChips");
        wrap.innerHTML = "";
        chips.forEach(c => {
          const span = document.createElement("span");
          span.className = "badge bg-label-primary me-2 mb-2 filter-chip";
          span.innerHTML = `${c.label} <button type="button" class="btn-close" aria-label="Kaldır"></button>`;
          span.querySelector(".btn-close").addEventListener("click", () => {
            // Basit kaldırma: ilgili alanı temizle ve tekrar uygula
            const form = document.getElementById("filterForm");
            if (c.key === "sadeceAktif") form.querySelector("#sadeceAktif").checked = false;
            else if (c.key === "q") form.querySelector("#q").value = "";
            else {
              const el = form.querySelector(`[name="${c.key}"]`);
              if (el) el.value = "";
            }
            applyFilters();
          });
          wrap.appendChild(span);
        });

        document.getElementById("activeFilterCount").textContent = String(chips.length);
      }

      function applyFilters() {
        const form = document.getElementById("filterForm");
        const f = getFormData(form);

        // Çipleri bas
        setChips(f);

        // Örnek tablo filtrele (gerçek projede backend/DB ile gelecek)
        const rows = Array.from(document.querySelectorAll("#taskTbody tr"));
        let visible = 0;

        rows.forEach(tr => {
          const kategori = tr.getAttribute("data-kategori") || "";
          const personel = tr.getAttribute("data-personel") || "";
          const durum = tr.getAttribute("data-durum") || "";

          let ok = true;
          if (f.kategori && kategori !== f.kategori) ok = false;
          if (f.personel && personel !== f.personel) ok = false;
          if (f.durum && durum !== f.durum) ok = false;
          if (f.sadeceAktif && durum !== "aktif") ok = false;

          tr.style.display = ok ? "" : "none";
          if (ok) visible++;
        });

        document.getElementById("resultCount").textContent = String(visible);
        document.getElementById("pagingInfo").textContent = `Gösterilen: ${visible} kayıt`;
      }

      function resetFilters() {
        const form = document.getElementById("filterForm");
        form.reset();
        applyFilters();
      }

      document.getElementById("filterForm").addEventListener("submit", function (e) {
        e.preventDefault();
        applyFilters();
      });

      document.getElementById("btnReset").addEventListener("click", resetFilters);

      document.getElementById("btnPrint").addEventListener("click", () => window.print());
      document.getElementById("btnExport").addEventListener("click", () => {
        alert("Dışa aktarma (Excel/PDF) entegrasyonu istersen bir sonraki adımda ekleyelim.");
      });

      // Mobil form -> desktop form ile senkron uygula
      document.getElementById("filterFormMobile").addEventListener("submit", function (e) {
        e.preventDefault();
        const f = getFormData(this);
        const desktop = document.getElementById("filterForm");
        desktop.querySelector("#q").value = f.q || "";
        desktop.querySelector("#kategori").value = f.kategori || "";
        desktop.querySelector("#durum").value = f.durum || "";
        desktop.querySelector("#tarihBas").value = f.tarihBas || "";
        desktop.querySelector("#tarihBit").value = f.tarihBit || "";
        desktop.querySelector("#sadeceAktif").checked = !!f.sadeceAktif;
        applyFilters();

        const offcanvasEl = document.getElementById("offcanvasFilters");
        const off = bootstrap.Offcanvas.getInstance(offcanvasEl);
        if (off) off.hide();
      });

      document.getElementById("btnResetMobile").addEventListener("click", function () {
        const m = document.getElementById("filterFormMobile");
        m.reset();
      });

      // İlk yüklemede sayacı kur
      applyFilters();
    </script>
  </body>
</html>
